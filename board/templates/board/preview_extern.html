{% extends "base.html" %}
{% load static humanize %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/stylesPreview_Extern.css' %}">
  <style type="text/css">
    #barra {
      display: none;
    }
  </style>
{% endblock extra_css %}


{% block header %}
<main id="content">
  <div id="title-container">
    <!--Exibir nome do aluno ou da turma não sei...-->
    <h2>Turma:</h2>
  </div>
  <div class="action-bar-container">
    <ul class="action-bar">
      <li><a href="{% url 'core:page_extern' %}">Voltar</a></li>
    </ul>    
  </div>
  <div class="box">
    <h4>Dados Pessoais</h4>
    <div class="photo-circle big">
      {% if form.instance.pk %}
          {% if form.instance.photo %}
            <img src="{{ form.instance.photo.url }}" alt="Foto da Placa">
          {% else %}
            <p>Nenhuma foto do cadastrada</p>
          {% endif %}
        {% endif %}
    </div>
    <div>
      <table class="info">
        <tbody>
          <tr>
            <td>Nome da placa</td>
            <td><input type="text" name="name" value="Nome da Placa" disabled></td>
            <td>Data formatura</td>
            <td><input type="date" name="graduation_date" value="Data de formatura" disabled></td>
          </tr>
          <tr>
            <td>Ano do período</td>
            <td><input type="text" name="year_graduation" value="Ano do periodo" disabled></td>
            <td>Período</td>
            <td>
              <select name="period_graduation" disabled>
                <option value="1" selected>1</option>
                <option value="2">2</option>
              </select> 
            </td>
          </tr>
          <tr>
            <td>Campi</td>
            <td>-------</td>
            <td>Curso</td>
            <td>
              <select name="course" disabled>
                {% for course in courses %}
                  <option 
                    value="{{ course.id }}"
                  >{{ course.name }}</option>
                {% endfor %}
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!--
  <ul class="tabs with-content">
    <li class="active">Egressos</li>
    <li>Mencionados</li>
    <li>Mensagem</li>
  </ul>
  -->


  <form method="POST" id="formUser" enctype="multipart/form-data">
    {% csrf_token %}
    <div id="new">
      <div>
        <label>Mensagem da turma</label>
        <textarea id="input3" cols="40" rows="10" name="message" placeholder="Mensagem" disabled></textarea>
      </div>
    </div>
    {% if form.instance.pk %}
      {% for mentioned in form.instance.mentioned.all %}
        <div id="new" class="new-mentioneds">
          <div>
            <label>Mencionados</label>
            <input id="input2" type="text" name="name_mentioned" value="{{ mentioned.name }}" disabled>
            <select name="mention_mentioned" id="input3" disabled>
              <option value="" selected="">---------</option>
              <option {% if mentioned.mention == 0 %} selected {% endif %} value="0">Reitor</option>
              <option {% if mentioned.mention == 1 %} selected {% endif %} value="1">Paraninfo</option>
              <option {% if mentioned.mention == 2 %} selected {% endif %} value="2">Patrono</option>
              <option {% if mentioned.mention == 3 %} selected {% endif %} value="3">DG</option>
              <option {% if mentioned.mention == 4 %} selected {% endif %} value="4">DE</option>
              <option {% if mentioned.mention == 5 %} selected {% endif %} value="5">Em memoria</option>
              <option {% if mentioned.mention == 6 %} selected {% endif %} value="6">Funcionário</option>
              <option {% if mentioned.mention == 7 %} selected {% endif %} value="7">Homenageado</option>
              <option {% if mentioned.mention == 8 %} selected {% endif %} value="8">Orador</option>
            </select>
          </div>
        </div>
      {% endfor %}
    {% endif %}

    <div id="new">
      <label>Egressos</label>
      {% if not egress %}
        <p id="input2">Nenhum egresso cadastrado na placa</p>
      {% endif %}
    </div>
    {% if egress %}
      <div id="table">
        <table>
          <tr>
            <th>Imagem</th>
            <th>Nome</th>
            <th>Matricula</th>
            <th>Email</th>
          </tr>
    
          {% for egress in egress %}
            <tr>
              <td>
                <img id="input2" src="{{ egress.photo.url }}" alt="Foto do Egresso">
              </td>
              <td>{{ egress.name }}</td>
              <td>{{ egress.enrollment }}</td>
              <td>{{ egress.email }}</td>
            </tr>
          {% endfor %}
        </table>
      </div>
    {% endif %}
  </form>
</main>
{% endblock header %}


{% block content %}
  <div class="modalcontainer">
    <div class="modal">
      <button class="fechar" onclick="modal()">X</button>
      <h3>AVISO</h3>
      <p>Deseja realmente excluir a placa?</p>
      <button class="botaocrud2" onclick="modal()">Cancelar</button>      
      <button class="botaocrud" onclick="deleteUser(event)">Excluir</button>
    </div>        
  </div>
{% endblock content %}


{% block extra_js %}
  <script type="text/javascript">
    function modal() {
      if(document.querySelector('.modalcontainer').classList.contains('show')) {
        document.querySelector('.modalcontainer').classList.remove('show');
      }
      else {
        document.querySelector('.modalcontainer').classList.add('show');
      }
    }
    
    const deleteInput = document.querySelector('#cabecalho #deleteA');
    const titleText = document.querySelector('#cabecalho #title');
    
    const name = document.querySelector('[name="name"]');
    const year = document.querySelector('[name="year_graduation"]');
    const message = document.querySelector('[name="message"]');
    const date = document.querySelector('[name="graduation_date"]');
    const mentioned = document.querySelector('[name="mentioned"]');
    const course = document.querySelector('[name="course"]');
    
    let pk = parseInt(window.location.pathname.split('/')[2]);
    if (pk) {
      fetch("/boards/api/" + pk, {
        method: "GET",
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
        }
      }).then(res => {
        res.json().then(item => {
          item.forEach(element => {
            console.log("element.year_graduation", element.year_graduation);

            name.value = element.name;
            year.value = element.year_graduation;
            message.value = element.message;
            date.value = element.graduation_date;
            mentioned.value = element.mentioned;
            course.value = element.course;
          });
        })
      }).catch(err => {
        console.log("ERROR: " + err);
      });

      function deleteUser(e) {
        e.preventDefault();

        fetch("/boards/api/" + pk + "/", {
          method: "DELETE",
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
          }
        }).then(res => {
          window.location.href = "/boards";
        }).catch(err => {
          console.log("ERROR: " + err);
        });
      }
    }
  </script>
{% endblock extra_js %}
